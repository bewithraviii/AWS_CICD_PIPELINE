version: 0.2

env:
  variables:
    FRONTEND_DIR: "AWS_CICD_PIPELINE/frontend"
    LAMBDA_DIR: "AWS_CICD_PIPELINE/lambda"
    CFN_DIR: "AWS_CICD_PIPELINE/cloudformation"

phases: 
  install:
    runtime-versions:
      nodejs: 20
    commands:
      - echo "Installing NPM dependencies..."
    build:
      commands:
        - echo "Building lambda project..."
        - cd lambda
        - zip -r ../LambdaFunction.zip .
        - cd ..
    post_build:
      commands:
        - echo "Uploading to S3..."
        - aws s3 cp LambdaFunction.zip s3://codepipeline-ap-south-1-6c44a6a5fa5c-435a-8992-7075167d17eb/ --region ap-south-1
artifacts:
  files:
    - LambdaFunction.zip
    - AWS_CICD_PIPELINE/cloudformation/**